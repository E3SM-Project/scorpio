PIO_TF_AUTO_TEST_SUB_BEGIN test_put_get_str_hslabs
  Implicit none
  type(file_desc_t) :: pio_file
  character(len=*), parameter :: filename = "test_pio_ncdf_get_str_hslabs.nc"
  type(var_desc_t)  :: var2d

  integer, parameter :: STR_LEN = 16

  character(len=*), parameter :: VAR_NAME_PREFIX1 = "var"
  character(len=*), parameter :: VAR_NAME_PREFIX2 = "v__"
  character(len=*), parameter :: VAR_NAME_SUFFIX1 = "d"
  character(len=*), parameter :: VAR_NAME_SUFFIX2 = "_"

  integer, parameter :: VAR2D_ID = 2
  character(len=STR_LEN) :: var2d_name
  character(len=*), parameter :: VAR_NAME_FMT = '(A3,I1,A1)'

  integer, parameter :: NDIMS = 3
  integer, dimension(NDIMS) :: pio_dims
  integer, parameter :: NUM_ROWS = 2
  character(len=*), parameter :: dim0_name = "slen"
  character(len=*), parameter :: dim1_name = "row"
  character(len=*), parameter :: dim2_name = "col"

  character(len=1), dimension(:), allocatable :: tmp_str

  integer, dimension(NDIMS) :: strt, cnt

  integer, dimension(:), allocatable :: iotypes
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs
  integer :: num_iotypes

  integer :: i, j, k, l, m, row, col, ret

  num_iotypes = 0
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)
  write(var2d_name, VAR_NAME_FMT) VAR_NAME_PREFIX1, VAR2D_ID, VAR_NAME_SUFFIX1

  do i=3,num_iotypes
    PIO_TF_LOG(0,*) "Testing type :", iotype_descs(i)
    ret = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)
    PIO_TF_CHECK_ERR(ret, "Failed to open:" // trim(filename))

    ret = PIO_def_dim(pio_file, dim0_name, STR_LEN, pio_dims(1))
    PIO_TF_CHECK_ERR(ret, "Failed to define dim 0:" // trim(filename))

    ret = PIO_def_dim(pio_file, dim1_name, NUM_ROWS, pio_dims(2))
    PIO_TF_CHECK_ERR(ret, "Failed to define dim 1:" // trim(filename))

    ret = PIO_def_dim(pio_file, dim2_name, 1, pio_dims(3))
    PIO_TF_CHECK_ERR(ret, "Failed to define dim 2:" // trim(filename))

    ret = PIO_def_var(pio_file, var2d_name, PIO_char, (/pio_dims(1), pio_dims(2), pio_dims(3)/), var2d)
    PIO_TF_CHECK_ERR(ret, "Failed to define 2 dim char array or 2d array of strings in file " // trim(filename))

    ret = PIO_enddef(pio_file)
    PIO_TF_CHECK_ERR(ret, "Failed to enddef:" // trim(filename))

    col = 1
    strt = 1
    cnt = 0

    strt(1) = 5
    strt(2) = 1
    strt(3) = 1
    cnt(1) = 1
    cnt(2) = NUM_ROWS
    cnt(3) = 1

    allocate(tmp_str(2))
    tmp_str(1) = 'X'
    tmp_str(2) = 'Y'

    ret = PIO_put_var(pio_file, var2d, strt, cnt, tmp_str);
    PIO_TF_CHECK_ERR(ret, "Failed to put 1d array of string suffixes in file " // trim(filename))

    deallocate(tmp_str)

    call PIO_closefile(pio_file)
    call PIO_deletefile(pio_tf_iosystem_, filename);
  end do
  if(allocated(iotypes)) then
    deallocate(iotypes)
    deallocate(iotype_descs)
  end if

PIO_TF_AUTO_TEST_SUB_END test_put_get_str_hslabs
